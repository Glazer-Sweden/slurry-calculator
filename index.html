<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Slurry Calculator – Adjust Liter Weight</title>

<!-- PWA -->
<link rel="manifest" href="/slurry-calculator/manifest.json">
<meta name="theme-color" content="#ffffff">
<link rel="icon" href="/slurry-calculator/icons/icon-192.png">

<!-- Service worker registration -->
<script>
/*
  IMPORTANT:
  - This must match the filename of your service worker.
  - For Version 9, the file is sw-v9.js.
  - When you release Version 10, rename to sw-v10.js and update this line.
*/

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/slurry-calculator/sw-v9c.js").then(reg => {
    reg.onupdatefound = () => {
      const newWorker = reg.installing;
      newWorker.onstatechange = () => {
        if (newWorker.state === "installed" && navigator.serviceWorker.controller) {
          const refresh = confirm("A new version of Slurry Calculator is available. Reload now?");
          if (refresh) window.location.reload();
        }
      };
    };
  });
}
</script>

<style>
/* (Your existing CSS unchanged — omitted here for clarity) */

body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
    background: #f4f4f4;
    padding: 2px;
    display: flex;
    justify-content: center;
}

.calculator-container {
    background: white;
    padding: 1px 2px 2px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    max-width: 680px;
    width: 100%;
}

table {
    border-collapse: collapse;
    width: 100%;
    table-layout: fixed;
}

td.label {
    padding: 6px 8px;
    font-size: 0.9rem;
    border: 1px solid #ccc;
    background: #fafafa;
    text-align: left;
}

td.value {
    padding: 6px 8px;
    font-size: 0.9rem;
    border: 1px solid #ccc;
    text-align: center;
    background: #fffbe6;
    white-space: nowrap;
    width: 20%;
}

td.value.readonly {
    background: #ffffff;
    color: #222;
}

input[type="number"] {
    width: 100%;
    box-sizing: border-box;
    padding: 3px 4px;
    font-size: 0.9rem;
    text-align: center;
    border: 1px solid #aaa;
    border-radius: 3px;
}

.blank-row td {
    border: none !important;
    height: 12px;
    background: transparent !important;
}

</style>

</head>

<body>

<!-- Offline banner -->
<div id="offlineBanner" 
     style="display:none; background:#ffcc00; padding:6px; text-align:center; font-size:0.9rem; width:100%; position:fixed; top:0; left:0; z-index:9999;">
  You are offline. Some features may be limited.
</div>

<!-- Your calculator HTML remains unchanged -->
<!-- (I am not repeating it here to keep this message readable) -->

<div class="calculator-container" style="margin-top:40px;">
<table>
<tbody>

<tr>
<td class="label" style="background:#0087ff;font-weight:bold;text-align:center;">Slurry Calculator For Adjusting The Liter Weight</td>
<td class="value readonly" style="font-weight:bold;background-color:#FFFF00;">Kilos</td>
</tr>

<tr>
<td class="label" style="background:#FFFF00;">Powder S.G. / Density (not needed)</td>
<td class="value"><input id="densityPowder" type="number" step="0.001" oninput="recalc()"></td>
</tr>

<tr>
<td class="label" style="background:#FF0;">Slurry Weight @ Start</td>
<td class="value"><input id="slurryWeightStart" type="number" step="0.01" oninput="recalc()" value="10.000"></td>
</tr>

<tr>
<td class="label" style="background:#FF0;">Slurry Liter Weight @ Start</td>
<td class="value"><input id="slurryLiterWeightStart" type="number" step="0.001" oninput="recalc()" value="1.800"></td>
</tr>

<tr>
<td class="label" style="background:#FF0;">Extra Water Added To Slurry</td>
<td class="value"><input id="extraWaterAdded" type="number" step="0.01" oninput="recalc()"></td>
</tr>

<tr>
<td class="label" style="background:#FF0;">Extra Powder Added To Slurry</td>
<td class="value"><input id="extraPowderAdded" type="number" step="0.01" oninput="recalc()"></td>
</tr>

<tr>
<td class="label" style="background:#FF0;">Target Liter Weight</td>
<td class="value"><input id="targetLiterWeight" type="number" step="0.001" oninput="recalc()" value="1.320"></td>
</tr>

<tr class="blank-row"><td colspan="2"></td></tr>

<tr>
<td class="label" style="background:#FF9900;font-weight:bold;">Liters of Slurry @ Start</td>
<td class="value readonly" id="volumeOfSlurryStart" style="background:#F90;font-weight:bold;">5.556</td>
</tr>

<tr class="blank-row"><td colspan="2"></td></tr>

<tr>
<td class="label" style="background:#0ff;font-weight:bold;">Weight of Water to Add or Remove</td>
<td class="value readonly" id="weightWaterToAdjust" style="background:#0ff;font-weight:bold;">8.333</td>
</tr>

<tr>
<td class="label" style="background:#0ff;">Total weight of powder in slurry</td>
<td class="value readonly" id="totalPowderInSlurry" style="background:#0ff;">N/A</td>
</tr>

<tr>
<td class="label" style="background:#0ff;">Total weight of water in slurry</td>
<td class="value readonly" id="totalWaterInSlurry" style="background:#0ff;">N/A</td>
</tr>

<tr>
<td class="label" style="background:#0ff;">Total weight of powder &amp; water</td>
<td class="value readonly" id="totalPowderAndWater" style="background:#0ff;">N/A</td>
</tr>

<tr>
<td class="label" style="background:#0ff;">Liters of Slurry</td>
<td class="value readonly" id="litersOfSlurry" style="background:#0ff;">N/A</td>
</tr>

<tr class="blank-row"><td colspan="2"></td></tr>

<tr>
<td class="label" style="background:#00FF00;font-weight:bold;">Weight of Powder to Add or Remove</td>
<td class="value readonly" id="weightPowderToAdjust" style="background:#0F0;font-weight:bold;">N/A</td>
</tr>

<tr>
<td class="label" style="background:#0F0;">Total weight of powder in slurry</td>
<td class="value readonly" id="totalPowderInSlurry2" style="background:#0F0;">N/A</td>
</tr>

<tr>
<td class="label" style="background:#0F0;">Total weight of water in slurry</td>
<td class="value readonly" id="totalWaterInSlurry2" style="background:#0F0;">N/A</td>
</tr>

<tr>
<td class="label" style="background:#0F0;">Total weight of powder &amp; water</td>
<td class="value readonly" id="totalPowderAndWater2" style="background:#0F0;">N/A</td>
</tr>

<tr>
<td class="label" style="background:#0F0;">Liters of Slurry</td>
<td class="value readonly" id="litersOfSlurryFinal" style="background:#0F0;">N/A</td>
</tr>

<tr class="blank-row"><td colspan="2"></td></tr>

<tr>
<td class="label" style="background:#0087ff;text-align:center;height: 80px;"> 
  <span style="display:block;">nicholas.glazer@gmail.com</span>
  <span style="display:block;">Grad.I.Ceram.</span>
  <span style="display:block;">Mobile/WhatsApp +46 739 315 028</span>
</td>
<td class="label" style="background:#0087FF;text-align: center;">IoM3</td>
</tr>

</tbody>
</table>

<!-- Force Update Button -->
<div style="text-align:center; margin-top:12px;">
  <button onclick="forceUpdate()" 
          style="padding:6px 12px; font-size:0.9rem; border-radius:6px; border:1px solid #888; background:#e6e6e6;">
    Force App Update
  </button>
</div>

<!-- Version number -->

<!--  <div style="text-align:center; font-size:0.8rem; color:#666; margin-top:10px;">  -->
<!--  Version 9.0  -->
<!--  </div>  -->

<div id="appVersion" 
     style="text-align:center; font-size:0.8rem; color:#666; margin-top:10px;">
  Version …
</div>


<script>
/* Your recalc() function — unchanged */

function recalc() {

const B2 = parseFloat(document.getElementById("densityPowder").value) || 0;
const B3 = parseFloat(document.getElementById("slurryWeightStart").value) || 0;
const B4 = parseFloat(document.getElementById("slurryLiterWeightStart").value) || 0;
const B5 = parseFloat(document.getElementById("extraWaterAdded").value) || 0;
const B6 = parseFloat(document.getElementById("extraPowderAdded").value) || 0;
const B7 = parseFloat(document.getElementById("targetLiterWeight").value) || 0;

// Block 1
let B9 = (B6 > 0 && B2 === 0) ? "N/A" : (((B3 * (B4 - B7)) / (B4 * (B7 - 1))) - B5);
document.getElementById("weightWaterToAdjust").textContent = B9 === "N/A" ? "N/A" : B9.toFixed(3);

let B10 = (B2 === 0) ? "N/A" : (B6 + (((B4 - 1) * B2 / (B2 - 1)) * (B3 / B4)));
document.getElementById("totalPowderInSlurry").textContent = B10 === "N/A" ? "N/A" : B10.toFixed(3);

let B11 = (B2 === 0) ? "N/A" : (B3 + B5 + (B9 === "N/A" ? 0 : B9) - (((B4 - 1) * B2 / (B2 - 1)) * (B3 / B4)));
document.getElementById("totalWaterInSlurry").textContent = B11 === "N/A" ? "N/A" : B11.toFixed(3);

let B12 = (B2 === 0 || B10 === "N/A" || B11 === "N/A") ? "N/A" : (B10 + B11);
document.getElementById("totalPowderAndWater").textContent = B12 === "N/A" ? "N/A" : B12.toFixed(3);

let B13 = (B2 === 0 || B12 === "N/A") ? "N/A" : (B12 / B7);
document.getElementById("litersOfSlurry").textContent = B13 === "N/A" ? "N/A" : B13.toFixed(3);

// Block 2
let B15 = (B2 === 0) ? "N/A" : ((-B2 * B4 * (B6 + B3 - B7 * B5 + B5) + B2 * B3 * B7 + B4 * B6 * B7) / (B4 * (B2 - B7)));
document.getElementById("weightPowderToAdjust").textContent = B15 === "N/A" ? "N/A" : B15.toFixed(3);

let B16 = (B2 === 0 || B15 === "N/A") ? "N/A" : (B15 + B6 + (((B4 - 1) * B2 / (B2 - 1)) * (B3 / B4)));
document.getElementById("totalPowderInSlurry2").textContent = B16 === "N/A" ? "N/A" : B16.toFixed(3);

let B17 = (B2 === 0) ? "N/A" : (B3 + B5 - (((B4 - 1) * B2 / (B2 - 1)) * (B3 / B4)));
document.getElementById("totalWaterInSlurry2").textContent = B17 === "N/A" ? "N/A" : B17.toFixed(3);

let B18 = (B2 === 0 || B16 === "N/A" || B17 === "N/A") ? "N/A" : (B16 + B17);
document.getElementById("totalPowderAndWater2").textContent = B18 === "N/A" ? "N/A" : B18.toFixed(3);

let B19 = (B2 === 0 || B18 === "N/A") ? "N/A" : (B18 / B7);
document.getElementById("litersOfSlurryFinal").textContent = B19 === "N/A" ? "N/A" : B19.toFixed(3);

// Block 3
let B21 = (B4 === 0) ? "N/A" : (B3 / B4);
document.getElementById("volumeOfSlurryStart").textContent = B21 === "N/A" ? "N/A" : B21.toFixed(3);

}
</script>


<script>
function forceUpdate() {
  // If a service worker is controlling the page, ask it to update
  if (navigator.serviceWorker && navigator.serviceWorker.getRegistration) {
    navigator.serviceWorker.getRegistration().then(reg => {
      if (reg) {
        reg.update().then(() => {
          // After updating, reload the page to activate the new version
          location.reload(true);
        });
      } else {
        // No service worker found — just reload normally
        location.reload(true);
      }
    });
  } else {
    // Browser doesn't support service workers — fallback reload
    location.reload(true);
  }
}
</script>


<script>
function requestAppVersion() {
  if (!navigator.serviceWorker || !navigator.serviceWorker.controller) {
    document.getElementById("appVersion").textContent = "Version (no SW)";
    return;
  }

  // Ask the service worker for its version
  navigator.serviceWorker.controller.postMessage("GET_VERSION");

  // Listen for the reply
  navigator.serviceWorker.addEventListener("message", event => {
    if (event.data && event.data.version) {
      document.getElementById("appVersion").textContent =
        "Version " + event.data.version;
    }
  });
}

// Run after page loads
window.addEventListener("load", requestAppVersion);
</script>


<script>
document.addEventListener("DOMContentLoaded", () => {
  function updateOnlineStatus() {
    const banner = document.getElementById("offlineBanner");
    const container = document.querySelector(".calculator-container");

    if (navigator.onLine) {
      banner.style.display = "none";
      container.style.marginTop = "0px";
    } else {
      banner.style.display = "block";
      container.style.marginTop = "40px";
    }
  }

  // Listen for connection changes
  window.addEventListener("online", updateOnlineStatus);
  window.addEventListener("offline", updateOnlineStatus);

  // Run once on load
  updateOnlineStatus();
});
</script>

  
<!-- Update Toast -->
<div id="updateToast" 
     style="
       display:none;
       position:fixed;
       bottom:20px;
       left:50%;
       transform:translateX(-50%);
       background:#333;
       color:#fff;
       padding:10px 16px;
       border-radius:6px;
       font-size:0.9rem;
       box-shadow:0 2px 6px rgba(0,0,0,0.3);
       z-index:99999;
     ">
  Checking for updates…
</div>


</body>
</html>




